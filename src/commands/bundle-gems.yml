description: >
  Verifies dependencies are met by installed gems or installs gems

parameters:
  bundle-path:
    description: Path to store gems bundle
    type: string
    default: vendor/bundle

# Have Nokogiri use system libraries to avoid a timeout
steps:
  - run:
      name: Install gems
      command: |
        bundle config build.nokogiri --use-system-libraries
        bundle check --path=<< parameters.bundle-path >> || bundle install --path=<< parameters.bundle-path >> --jobs=4 --retry=3
